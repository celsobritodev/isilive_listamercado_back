name: Deploy BackEnd ListaMercado

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest
    name: Build with Java 25
    
    steps:
    # faz o download do codigo para este container
    - uses: actions/checkout@v4
    
    - name: Set up JDK 25
      uses: actions/setup-java@v4
      with:
        java-version: '25'
        distribution: 'temurin'
        cache: 'maven'
        
    - name: Build with Maven (Skip Tests)
      run: mvn -B clean compile -DskipTests
    - name: Listing contents
      run: ls -la ./target      
      
    - name: Package Application
      # gera o jar
      run: mvn -B package -DskipTests


  
      
    - name: List generated JAR files
      run: |
        echo "=== JAR Files Generated ==="
        ls -la target/*.jar
        echo "=== Detailed JAR Info ==="
        for jar in target/*.jar; do
          if [ -f "$jar" ]; then
            echo "ðŸ“¦ JAR: $(basename $jar)"
            echo "   Size: $(du -h $jar | cut -f1)"
            echo "   Path: $jar"
          fi
        done
      
    - name: Upload JAR to GitHub
      uses: actions/upload-artifact@v4
      with:
        name: lista-mercado-app
        path: target/*.jar
        
    - name: Copy JAR to Virtual Machine
      uses: appleboy/scp-action@v0.1.7
      with:
        host: "192.168.0.7"
        username: "userlista"
        password: ${{ secrets.VM_PASSWORD }}
        port: 22
        source: "target/*.jar"
        target: "/root/listamercado/"
        overwrite: true
